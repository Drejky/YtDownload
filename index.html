<!DOCTYPE html>
<html lang="en">
<head>
    <title>Yay</title>
    <script type="text/javasript" src="dl.js"></script>		
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body>

    <label>Enter name of mp3</label>
    <input type="text" id="name" autofocus>
    <br>
    <label>Enter link</label>
    <input type="text" id="link">
    <br>
    <button type="button" id="dl">Download</button>
    <button type="button" id="browse">Browse</button>
    <div class="placeholder"></div>

    
    <script>window.$ = window.jQuery = require('jquery');</script>
    <script>
        const electron = require('electron');
        const {dialog} = electron;
        const ytdl = require('ytdl-core');
        const fs = require('fs');
        let path;



        function doTheDownload(name, link){
            const foo = ytdl(link, {
                filter: "audioonly",
                quality: "highest"
            });
            
            foo.pipe(fs.createWriteStream(name+'.mp3'));
            
            foo.on('response', (res) =>{
                let totalSize = res.headers['content-length'];  
                let dataTotal = 0;
                var toAppend = 
                "<div class=\"progress\" id=\"toRemove\">"
                    +"<div class=\"progress-bar\" id=\"progBar\" role=\"progressbar\" style=\"width: 0%\" aria-valuenow=\"25\" aria-valuemin=\"0\" aria-valuemax=\"100\"></div>"
                +"</div>";
                $('.placeholder').append(toAppend);

                res.on("data", (data)=> {
                    let buffer = data.length;
                    dataTotal += buffer;
                    let percentage = dataTotal/totalSize * 100;
                    console.log (percentage);
                    document.getElementById('progBar').style.width = percentage + "%";
                    document.getElementById('progBar').innerHTML = Math.ceil(percentage) + "%";
                  
                    
                    if(percentage === 100){
                        delete foo;
                        $('#toRemove').remove();
                        console.log(foo);
                    }
                });
            });            
        }

        function openBrowserWindow(){
            dialog.showOpenDialog({properties:['openDirectory']}, (folderPath)=>{
                console.log(folderPath);
            });
        }

        $(document).ready(()=>{
            $('#dl').click(()=>{
                let name = $('#name').val();
                let link = $('#link').val();
                doTheDownload(name, link);
            });
            
            $('#browse').click(()=>{
                openBrowserWindow();
            });
        });
    </script>
</body>
</html>