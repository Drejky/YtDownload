<!DOCTYPE html>
<html lang="en">
<head>
    <title>Yay</title>
    <script type="text/javasript" src="dl.js"></script>		
</head>
<body>

    <label>Enter name of mp3</label>
    <input type="text" id="name" autofocus>

    <label>Enter link</label>
    <input type="text" id="link">

    <button type="button" id="dl">Download</button>
    <button type="button" id="browse">Browse</button>

    
    <script>window.$ = window.jQuery = require('jquery');</script>
    <script>
        const electron = require('electron');
        const {dialog} = electron;
        const ytdl = require('ytdl-core');
        const fs = require('fs');
        let path;

        function doTheDownload(name, link){
            const foo = ytdl(link, {
                filter: "audioonly",
                quality: "highest"
            });
            
            foo.pipe(fs.createWriteStream(name+'.mp3'));

            foo.on('response', (res) =>{
                let totalSize = res.headers['content-length'];  
                let dataTotal = 0;

                res.on("data", (data)=> {
                    let buffer = data.length;
                    dataTotal += buffer;
                    let percentage = dataTotal/totalSize * 100;
                    console.log (percentage);
                    if(percentage === 100){
                        delete foo;
                        console.log(foo);
                    }
                });
            });            
        }

        function openBrowserWindow(){
            dialog.showOpenDialog({properties:['openDirectory']}, (folderPath)=>{
                console.log(folderPath);
            });
        }

        $(document).ready(()=>{
            $('#dl').click(()=>{
                let name = $('#name').val();
                let link = $('#link').val();
                doTheDownload(name, link);
            });
            
            $('#browse').click(()=>{
                openBrowserWindow();
            });
        });


    </script>
</body>
</html>